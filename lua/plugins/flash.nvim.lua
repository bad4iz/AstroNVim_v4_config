-- if true then return {} end -- WARN: УДАЛИТЕ ЭТУ СТРОКУ ДЛЯ АКТИВАЦИИ ПЛАГИНА

--[[
═══════════════════════════════════════════════════════════════════════════════
FLASH.NVIM - Навигация со скоростью света!
═══════════════════════════════════════════════════════════════════════════════

ОПИСАНИЕ:
  Flash.nvim - это современный плагин для навигации в Neovim, использующий метки
  для моментальных прыжков к нужному месту. Поддерживает поиск, улучшенные движения
  символов и интеграцию с Treesitter.

ОСНОВНЫЕ ВОЗМОЖНОСТИ:
  • Навигация с метками - прыжки к любому видимому месту за 2-3 нажатия
  • Интеграция с поиском (/, ?) - метки появляются на результатах поиска
  • Улучшенные f, t, F, T движения с опциональными метками
  • Treesitter интеграция - прыжки по синтаксическим узлам
  • Прыжки между окнами - навигация по всем видимым буферам
  • Режимы поиска: точный, regex, fuzzy
  • Поддержка повтора через точку (.)

ОСНОВНЫЕ КОМАНДЫ:

  require("flash").jump()
    Основной режим прыжков с поиском. Введите начальные символы для поиска,
    затем используйте метки для прыжка к нужному совпадению.

  require("flash").treesitter()
    Прыжки по синтаксическим узлам кода. Показывает метки на функциях,
    классах, блоках и других структурах кода.

  require("flash").remote()
    Удалённые операции. Позволяет выполнять операторы (d, c, y) на удалённых
    участках кода без перемещения курсора.

  require("flash").treesitter_search()
    Поиск по синтаксическим узлам с метками. Комбинирует возможности
    Treesitter и обычного поиска.

  require("flash").toggle()
    Переключение Flash поиска в командном режиме. Используется во время
    ввода команды поиска (/) для включения/выключения меток.

ГОРЯЧИЕ КЛАВИШИ (настроены ниже):

  s         - Flash jump (основной режим прыжков)
              Режимы: normal, visual, operator-pending

  S         - Flash Treesitter (навигация по синтаксическим узлам)
              Режимы: normal, visual, operator-pending

  r         - Remote Flash (удалённые операции)
              Режим: operator-pending
              Пример: dr + метка = удалить до метки

  R         - Treesitter Search (поиск по синтаксическим узлам)
              Режимы: operator-pending, visual

  <C-s>     - Toggle Flash Search (в командном режиме)
              Режим: command
              Используйте во время ввода / или ?

  t / T     - Flash char движения (перехватывается автоматически)
              t<символ> - прыжок ДО символа вперёд (с метками если много совпадений)
              T<символ> - прыжок ДО символа назад
              ; - повторить движение
              , - отменить движение

ИНТЕГРАЦИЯ С HOP:
  f         - Hop hint words (настроено в hop.lua, НЕ перехватывается Flash)
  F         - Стандартное vim движение (не используется ни Flash, ни Hop)

  Комбинация Flash + Hop даёт лучшее из двух миров:
  - f для быстрых прыжков по словам (Hop)
  - t/T для точной навигации до символа с метками (Flash)
  - s для универсальных прыжков (Flash)

ПРИМЕРЫ ИСПОЛЬЗОВАНИЯ:

  1. Базовый прыжок:
     - Нажмите 's'
     - Начните вводить искомый текст
     - Появятся метки, введите символы метки для прыжка

  2. Прыжок к функции:
     - Нажмите 'S' (Flash Treesitter)
     - Метки появятся на всех функциях/классах/блоках
     - Введите символы метки для прыжка

  3. Удалённое удаление:
     - Нажмите 'dr' (delete + remote)
     - Появятся метки
     - Введите метку - текст от курсора до метки будет удалён

  4. Прыжок с поиском:
     - Нажмите '/' для поиска
     - Начните вводить паттерн
     - Нажмите <C-s> для включения меток Flash
     - Введите символы метки для прыжка к нужному совпадению

  5. Использование t/T с метками (Flash):
     Текст: "hello world, how are you"
     - Нажмите 't,' (прыжок до запятой)
     - Если запятых несколько - появятся метки
     - Введите метку для выбора нужной запятой
     - Используйте с операторами: dt, = удалить до запятой

  6. Комбинация Hop + Flash:
     - 'f' для быстрого прыжка по словам (Hop)
     - 't<символ>' для точного позиционирования (Flash)
     - 's' для универсального поиска (Flash)

ОСНОВНЫЕ ОПЦИИ КОНФИГУРАЦИИ:

  modes.search.enabled      - Интеграция с / и ? (по умолчанию: true)
  modes.char.enabled        - Улучшенные f, t, F, T (по умолчанию: true)
  modes.char.jump_labels    - Метки для char режима (по умолчанию: false)

  search.multi_window       - Поиск во всех окнах (по умолчанию: true)
  search.forward           - Направление поиска (по умолчанию: true)
  search.wrap              - Зацикленный поиск (по умолчанию: true)

  label.uppercase          - Заглавные метки (по умолчанию: true)
  label.rainbow.enabled    - Радужные цвета для меток (по умолчанию: false)

  jump.autojump            - Автопрыжок при единственном совпадении (по умолчанию: false)
  jump.pos                 - Позиция курсора: "start", "end", "range"

  highlight.backdrop       - Затемнение фона (по умолчанию: true)

КОНФИГУРАЦИЯ НИЖЕ:
  - char.enabled = true - включены t/T движения с метками Flash
  - char.keys = { "t", "T" } - только t/T, f/F остаются за Hop
  - char.jump_labels = true - метки показываются при множественных совпадениях
  - ; и , работают для повтора/отмены движения (как в стандартном vim)

СИСТЕМНЫЕ ТРЕБОВАНИЯ:
  - Neovim ≥ 0.8.0 (собран с LuaJIT)
  - Treesitter (опционально, для S и R команд)

ПОДРОБНЕЕ: https://github.com/folke/flash.nvim
═══════════════════════════════════════════════════════════════════════════════
--]]
return {
  "folke/flash.nvim",
  event = "VeryLazy", -- Загружаться после запуска для ускорения старта
  ---@type Flash.Config
  opts = {
    modes = {
      char = {
        -- Включаем char режим для t/T движений
        -- f/F остаются за Hop (настроены ниже через keys)
        enabled = true,
        -- Включаем метки для char движений
        jump_labels = true,
        -- Отключаем f/F, оставляем только t/T
        keys = { "f", "F" },
        -- Альтернативный вариант с повторами через ; и ,
        char_actions = function(motion)
          return {
            [";"] = "next", -- ; для следующего совпадения
            [","] = "prev", -- , для предыдущего совпадения
          }
        end,
      },
    },
    -- Раскомментируйте опции ниже для дополнительной настройки:
    -- search = {
    --   multi_window = true,    -- Поиск во всех видимых окнах
    --   forward = true,         -- Направление поиска вперёд
    --   wrap = true,            -- Зацикленный поиск
    -- },
    -- label = {
    --   uppercase = false,      -- Метки в нижнем регистре
    --   rainbow = {
    --     enabled = true,       -- Радужные цвета для диапазонов
    --   },
    -- },
    -- jump = {
    --   autojump = true,        -- Автопрыжок при единственном совпадении
    -- },
  },
  keys = {
    -- s: Основной режим Flash - прыжок к любому месту
    -- Работает в normal (n), visual (x), operator-pending (o) режимах
    { "s", mode = { "n", "x", "o" }, function() require("flash").jump() end, desc = "Flash: прыжок" },

    -- S: Treesitter навигация - прыжок по синтаксическим узлам
    -- Полезно для быстрого перехода к функциям, классам, блокам кода
    { "S", mode = { "n", "x", "o" }, function() require("flash").treesitter() end, desc = "Flash: Treesitter" },

    -- r: Удалённые операции - применить оператор к удалённому месту
    -- Пример: dr<метка> = удалить до метки, cr<метка> = изменить до метки
    { "r", mode = "o", function() require("flash").remote() end, desc = "Flash: удалённая операция" },

    -- R: Treesitter поиск - поиск по синтаксическим узлам
    -- Комбинирует возможности поиска и Treesitter навигации
    {
      "R",
      mode = { "o", "x" },
      function() require("flash").treesitter_search() end,
      desc = "Flash: Treesitter поиск",
    },

    -- <C-s>: Переключение Flash во время поиска
    -- Используйте во время ввода / или ? для включения/выключения меток
    {
      "<c-s>",
      mode = { "c" },
      function() require("flash").toggle() end,
      desc = "Flash: переключить в поиске",
    },
  },
}
